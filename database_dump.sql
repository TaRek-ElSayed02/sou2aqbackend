-- Database dump for Sou2aq application
-- Generated from project source on 2026-02-09
-- MySQL compatible (utf8mb4)

SET FOREIGN_KEY_CHECKS = 0;

DROP TABLE IF EXISTS user_sessions;
DROP TABLE IF EXISTS wishlists;
DROP TABLE IF EXISTS carts;
DROP TABLE IF EXISTS social_media;
DROP TABLE IF EXISTS maps;
DROP TABLE IF EXISTS comments;
DROP TABLE IF EXISTS site;
DROP TABLE IF EXISTS blog;
DROP TABLE IF EXISTS products;
DROP TABLE IF EXISTS users;

-- users
CREATE TABLE users (
  id VARCHAR(36) NOT NULL PRIMARY KEY,
  fullName VARCHAR(255) DEFAULT NULL,
  userName VARCHAR(50) NOT NULL,
  email VARCHAR(255) NOT NULL,
  password VARCHAR(255) NOT NULL,
  role ENUM('user','admin','superAdmin') NOT NULL DEFAULT 'user',
  DoB DATE DEFAULT NULL,
  phone VARCHAR(20) DEFAULT NULL,
  isActive ENUM('yes','no') NOT NULL DEFAULT 'no',
  profileImage VARCHAR(255) DEFAULT NULL,
  emailOTP VARCHAR(50) DEFAULT NULL,
  emailOTPExpiresAt DATETIME DEFAULT NULL,
  emailVerifiedAt DATETIME DEFAULT NULL,
  createdAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  modifiedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY ux_users_email (email),
  UNIQUE KEY ux_users_username (userName)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- products
CREATE TABLE products (
  id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  user_id VARCHAR(36) DEFAULT NULL,
  name VARCHAR(255) NOT NULL,
  url VARCHAR(255) DEFAULT NULL,
  category VARCHAR(100) DEFAULT NULL,
  price DECIMAL(12,2) DEFAULT NULL,
  discount DECIMAL(12,2) DEFAULT NULL,
  image VARCHAR(255) DEFAULT NULL,
  imgAlt VARCHAR(255) DEFAULT NULL,
  quantityInStock INT DEFAULT 0,
  availableSizes TEXT DEFAULT NULL,
  materials TEXT DEFAULT NULL,
  description TEXT DEFAULT NULL,
  seoTitle VARCHAR(255) DEFAULT NULL,
  seoDescription VARCHAR(512) DEFAULT NULL,
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  KEY idx_products_user (user_id),
  KEY idx_products_url (url)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- blog
CREATE TABLE blog (
  id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  title VARCHAR(255) NOT NULL,
  content MEDIUMTEXT NOT NULL,
  image VARCHAR(255) DEFAULT NULL,
  description TEXT DEFAULT NULL,
  url VARCHAR(255) DEFAULT NULL,
  category VARCHAR(100) DEFAULT NULL,
  imgAlt VARCHAR(255) DEFAULT NULL,
  tags VARCHAR(255) DEFAULT NULL,
  author VARCHAR(255) DEFAULT NULL,
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- site
CREATE TABLE `site` (
  id VARCHAR(36) NOT NULL PRIMARY KEY,
  name VARCHAR(255) DEFAULT NULL,
  image VARCHAR(255) DEFAULT NULL,
  imageAlt VARCHAR(255) DEFAULT NULL,
  description TEXT DEFAULT NULL,
  phone VARCHAR(50) DEFAULT NULL,
  user_id VARCHAR(36) NOT NULL,
  about TEXT DEFAULT NULL,
  whyUs TEXT DEFAULT NULL,
  QandA TEXT DEFAULT NULL,
  privacy_policy TEXT DEFAULT NULL,
  termsOfUse TEXT DEFAULT NULL,
  `returning` TEXT DEFAULT NULL,
  subdomain VARCHAR(100) DEFAULT NULL,
  email VARCHAR(255) DEFAULT NULL,
  isActive ENUM('yes','no') NOT NULL DEFAULT 'no',
  createdAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  modifiedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY ux_site_subdomain (subdomain),
  KEY idx_site_user (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- comments
CREATE TABLE comments (
  id VARCHAR(36) NOT NULL PRIMARY KEY,
  siteId VARCHAR(36) NOT NULL,
  comment TEXT DEFAULT NULL,
  rate TINYINT DEFAULT NULL,
  customerName VARCHAR(255) DEFAULT NULL,
  createdAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  modifiedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  KEY idx_comments_site (siteId)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- maps
CREATE TABLE maps (
  id VARCHAR(36) NOT NULL PRIMARY KEY,
  siteId VARCHAR(36) NOT NULL,
  url VARCHAR(255) DEFAULT NULL,
  address TEXT DEFAULT NULL,
  phone VARCHAR(50) DEFAULT NULL,
  email VARCHAR(255) DEFAULT NULL,
  periodOpen VARCHAR(255) DEFAULT NULL,
  isActive ENUM('yes','no') NOT NULL DEFAULT 'yes',
  createdAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  modifiedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  KEY idx_maps_site (siteId)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- social_media
CREATE TABLE social_media (
  id VARCHAR(36) NOT NULL PRIMARY KEY,
  name VARCHAR(100) DEFAULT NULL,
  icon VARCHAR(255) DEFAULT NULL,
  link VARCHAR(512) DEFAULT NULL,
  siteId VARCHAR(36) NOT NULL,
  createdAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  modifiedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  KEY idx_social_site (siteId)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- carts
CREATE TABLE carts (
  id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  user_id VARCHAR(36) NOT NULL,
  product_id INT NOT NULL,
  quantity INT NOT NULL DEFAULT 1,
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  UNIQUE KEY ux_carts_user_product (user_id, product_id),
  KEY idx_carts_user (user_id),
  KEY idx_carts_product (product_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- wishlists
CREATE TABLE wishlists (
  id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  user_id VARCHAR(36) NOT NULL,
  product_id INT NOT NULL,
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  UNIQUE KEY ux_wishlists_user_product (user_id, product_id),
  KEY idx_wishlists_user (user_id),
  KEY idx_wishlists_product (product_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- user_sessions
CREATE TABLE user_sessions (
  id VARCHAR(36) NOT NULL PRIMARY KEY,
  user_id VARCHAR(36) NOT NULL,
  device_id VARCHAR(255) DEFAULT NULL,
  refresh_token VARCHAR(500) DEFAULT NULL,
  user_agent VARCHAR(500) DEFAULT NULL,
  ip_address VARCHAR(45) DEFAULT NULL,
  expires_at DATETIME DEFAULT NULL,
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_revoked TINYINT(1) NOT NULL DEFAULT 0,
  KEY idx_sessions_user (user_id),
  KEY idx_sessions_device (device_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Foreign keys (best-effort)
ALTER TABLE products
  ADD CONSTRAINT fk_products_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL ON UPDATE CASCADE;

ALTER TABLE site
  ADD CONSTRAINT fk_site_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE comments
  ADD CONSTRAINT fk_comments_site FOREIGN KEY (siteId) REFERENCES site(id) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE maps
  ADD CONSTRAINT fk_maps_site FOREIGN KEY (siteId) REFERENCES site(id) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE social_media
  ADD CONSTRAINT fk_social_site FOREIGN KEY (siteId) REFERENCES site(id) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE carts
  ADD CONSTRAINT fk_carts_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT fk_carts_product FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE wishlists
  ADD CONSTRAINT fk_wishlists_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT fk_wishlists_product FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE user_sessions
  ADD CONSTRAINT fk_sessions_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE ON UPDATE CASCADE;

SET FOREIGN_KEY_CHECKS = 1;

-- End of dump
